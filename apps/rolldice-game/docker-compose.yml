version: '3'
services:
  game_controller:
    build:
      context: ./game_controller
      dockerfile: Dockerfile
    ports:
      - "5002:5002"
    depends_on:
      otelcol:
        condition: service_started
      rolling:
        condition: service_started
      scoring:
        condition: service_started


  rolling:
    build:
      context: ./rolling
      dockerfile: Dockerfile
    ports:
      - "5004"
    depends_on:
      otelcol:
        condition: service_started


  scoring:
    build:
      context: ./scoring
      dockerfile: Dockerfile
    ports:
      - "5001"
    depends_on:
      otelcol:
        condition: service_started


  otelcol:
    image: otel/opentelemetry-collector-contrib
    deploy:
      resources:
        limits:
          memory: 200M
    restart: unless-stopped
    command: [ "--config=/etc/otelcol-config.yml"]
    volumes:
      - ./config.yml:/etc/otelcol-config.yml
    ports:
      - "4318" # OTLP http receiver
      - "4317"
      

